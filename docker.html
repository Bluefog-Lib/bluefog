

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Bluefog Docker Usage &mdash; Bluefog  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Bluefog Environment Variables" href="env_variable.html" />
    <link rel="prev" title="Running Bluefog Through bfrun" href="running.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Bluefog
          

          
          </a>

          
            
            
              <div class="version">
                0.2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing Bluefog</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="torch_api.html">Bluefog Torch API</a></li>
<li class="toctree-l1"><a class="reference internal" href="topo_api.html">Bluefog Topology API</a></li>
</ul>
<p class="caption"><span class="caption-text">More Information</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bluefog_ops.html">Bluefog Ops Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Bluefog Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="neighbor_average.html">Static and Dynamic Topology Neighbor Averaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Lauching Application Through bfrun</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Bluefog Docker Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installing-docker-image">Installing Docker Image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#downloading-docker-image-from-docker-hub">Downloading Docker Image From Docker Hub</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-your-own-docker-image">Building Your Own Docker Image</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-docker-container">Running Docker Container</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nvidia-container-runtime">Nvidia Container Runtime</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-examples-in-docker-containers">Running Examples in Docker Containers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="env_variable.html">Bluefog Environment Variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="timeline.html">Bluefog Timeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="alg_spectrum.html">Spectrum of Machine Learning Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_structure.html">Codebase Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="devel_guide.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Bluefog</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Bluefog Docker Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/docker.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bluefog-docker-usage">
<span id="docker-usage"></span><h1>Bluefog Docker Usage<a class="headerlink" href="#bluefog-docker-usage" title="Permalink to this headline">¶</a></h1>
<p>Bluefog provides dockers with all necessary dependency for system environment isolation.
Therefore two types of dockerfiles inside the project.
<code class="docutils literal notranslate"><span class="pre">dockerfile.cpu</span></code> and <code class="docutils literal notranslate"><span class="pre">dockerfile.gpu</span></code> are two files used for actual deployment,
and <code class="docutils literal notranslate"><span class="pre">dockerfile.cpu.test</span></code> and <code class="docutils literal notranslate"><span class="pre">dockerfile.gpu.test</span></code> are used for internal development.
This document will focus on the usage of <code class="docutils literal notranslate"><span class="pre">dockerfile.cpu</span></code> and <code class="docutils literal notranslate"><span class="pre">dockerfile.gpu</span></code>.
For the dockerfiles for development, the readers can check the Github Wiki for more details.</p>
<div class="section" id="installing-docker-image">
<h2>Installing Docker Image<a class="headerlink" href="#installing-docker-image" title="Permalink to this headline">¶</a></h2>
<p>The docker images can be built from scratch or be obtained from
<a class="reference external" href="https://hub.docker.com/r/bluefoglib/bluefog">Docker Hub</a>.</p>
<div class="section" id="downloading-docker-image-from-docker-hub">
<h3>Downloading Docker Image From Docker Hub<a class="headerlink" href="#downloading-docker-image-from-docker-hub" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Download docker image with CUDA support:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo docker pull bluefoglib/bluefog:gpu-0.2.2
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Download docker image with only CPU support:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo docker pull bluefoglib/bluefog:cpu-0.2.2
</pre></div>
</div>
</div>
<div class="section" id="building-your-own-docker-image">
<h3>Building Your Own Docker Image<a class="headerlink" href="#building-your-own-docker-image" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Build docker image with CUDA support:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo docker build -t bluefog_gpu . -f dockerfile.gpu
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Build docker image with only CPU support:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo docker build -t bluefog_cpu . -f dockerfile.cpu
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-docker-container">
<h2>Running Docker Container<a class="headerlink" href="#running-docker-container" title="Permalink to this headline">¶</a></h2>
<p>Here we used the docker images built from scratch as examples.
Please make sure you used the correct docker image name in the following commands,
if you download the docker image from <a class="reference external" href="https://hub.docker.com/r/bluefoglib/bluefog">Docker Hub</a>.</p>
<ol class="arabic simple">
<li><p>Run docker container with CUDA support:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo docker run --privileged -it --gpus all --name bluefog_gpu_deploy --shm-size<span class="o">=</span>64g --network<span class="o">=</span>host -v /mnt/share/ssh:/root/.ssh bluefog_gpu:latest
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run docker container with only CPU support:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo docker run --privileged -it --name bluefog_cpu_deploy --network<span class="o">=</span>host -v /mnt/share/ssh:/root/.ssh bluefog_cpu:latest
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Clean up docker system after running:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo docker system prune
</pre></div>
</div>
<div class="section" id="nvidia-container-runtime">
<h3>Nvidia Container Runtime<a class="headerlink" href="#nvidia-container-runtime" title="Permalink to this headline">¶</a></h3>
<p>The following error may pop up when running a docker container with GPUs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker: Error response from daemon: could not <span class="k">select</span> device driver <span class="s2">&quot;&quot;</span> with capabilities: <span class="o">[[</span>gpu<span class="o">]]</span>.
</pre></div>
</div>
<p>In order to properly run docker with GPUs,
Nvidia container runtime needs to be installed using following commands for Ubuntu.
Furthermore, the GPU driver is also required.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -s -L https://nvidia.github.io/nvidia-container-runtime/gpgkey <span class="p">|</span> <span class="se">\</span>
    sudo apt-key add -
<span class="nv">distribution</span><span class="o">=</span><span class="k">$(</span>. /etc/os-release<span class="p">;</span><span class="nb">echo</span> <span class="nv">$ID$VERSION_ID</span><span class="k">)</span>
curl -s -L https://nvidia.github.io/nvidia-container-runtime/<span class="nv">$distribution</span>/nvidia-container-runtime.list <span class="p">|</span> <span class="se">\</span>
    sudo tee /etc/apt/sources.list.d/nvidia-container-runtime.list
sudo apt-get update
sudo apt-get install nvidia-container-runtime
sudo service docker restart
</pre></div>
</div>
<p>More details can be found on
<a class="reference external" href="https://github.com/NVIDIA/nvidia-container-runtime">https://github.com/NVIDIA/nvidia-container-runtime</a>
and <a class="reference external" href="https://nvidia.github.io/nvidia-container-runtime">https://nvidia.github.io/nvidia-container-runtime</a>.</p>
</div>
</div>
<div class="section" id="running-examples-in-docker-containers">
<h2>Running Examples in Docker Containers<a class="headerlink" href="#running-examples-in-docker-containers" title="Permalink to this headline">¶</a></h2>
<p>The docker images have already included a few examples for the Bluefog library and some unittests for users.</p>
<ol class="arabic simple">
<li><p>UnitTest in docker container</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./run_unittest.sh
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Examples in docker container</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bfrun -np <span class="m">4</span> python examples/pytorch_mnist.py
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="env_variable.html" class="btn btn-neutral float-right" title="Bluefog Environment Variables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="running.html" class="btn btn-neutral float-left" title="Running Bluefog Through bfrun" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, BlueFog Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>